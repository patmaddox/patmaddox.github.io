---
layout: post
title: I Think I Might Not Get Mocks
date: 2007-04-10 00:24:34.000000000 -06:00
categories: []
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _wp_rp_related_posts_query_result_cache_expiration: '1442212474'
  _wp_rp_related_posts_query_result_cache_4: a:8:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:3:"166";s:5:"score";s:17:"21.53013535750355";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:2:"38";s:5:"score";s:18:"19.873491439688536";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:3:"172";s:5:"score";s:18:"17.465545831091834";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:3:"162";s:5:"score";s:18:"16.800860144864465";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:3:"127";s:5:"score";s:18:"16.555655500376353";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:3:"248";s:5:"score";s:18:"14.103752078397275";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:3:"125";s:5:"score";s:18:"13.783066778136572";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"1101";s:5:"score";s:18:"13.341486063748285";}}
author:
  login: pat
  email: patmaddox@me.com
  display_name: pat
  first_name: Pat
  last_name: Maddox
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>I was reading Aslak HellesÃ¸y&#8217;s article about the <a href="http://blog.aslakhellesoy.com/2006/12/11/the-bdd-cargo-cult">BDD cargo cult</a> and came across this quote:</p>
<div class="quote"><q>what a lot of people do instead is to use <a href="http://www.martinfowler.com/articles/mocksArentStubs.html#State-basedTesting">state-based testing</a>. That is fine too, but it ain&#8217;t BDD</q></div>
<p>Okay, I can understand where he&#8217;s coming from when he says that&#8230;behavior is all about interactions, and if you&#8217;re not testing interactions then you&#8217;re really not testing behavior at all.</p>
<p>However, mocks have lots of duplication.  Here&#8217;s a spec for a very, very simple action - adding a book to a list:</p>
<p><script src="http://gist.github.com/482400.js?file=gistfile1.rb"></script>
<p>and the corresponding action:</p>
<p><script src="http://gist.github.com/482401.js?file=gistfile1.rb"></script>
<p>I&#8217;ve been using mock objects a lot over the past few months, and have been trying to get a feel for how best to use them.  Most of my controller specs look a lot like the one you see above&#8230;most of the expectations are mock expectations, then maybe some state-based checking to see if instance variables are set and what page is rendered.</p>
<p>What really bothers me though is that there&#8217;s a lot of duplication there.  We &#8220;call&#8221; Book#new in the spec and then call it for real in the code.  The specs are more brittle, of course.  I&#8217;ve explained that away by saying that the controller is telling a story, and if the story changes then the specs describing it should have to as well.  In my example, we don&#8217;t need to verify that add_book works, we just assume there&#8217;s another spec that proves it elsewhere.</p>
<p>It just bothers me though.  Maybe my mind is geared more towards state-based testing?  What&#8217;s probably more likely is that I&#8217;m just using mock objects all wrong.  Anyone have any opinions on this?  I&#8217;d love some insight.</p>
