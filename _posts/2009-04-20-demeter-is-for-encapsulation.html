---
layout: post
title: Demeter Is for Encapsulation
date: 2009-04-20 15:26:17.000000000 -06:00
categories: []
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _wp_rp_related_posts_query_result_cache_expiration: '1441213167'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:3:"172";s:5:"score";s:18:"15.952243752900351";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:3:"928";s:5:"score";s:18:"15.376879607996788";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"1041";s:5:"score";s:18:"10.839512525394543";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:3:"238";s:5:"score";s:17:"9.074734165135526";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:3:"260";s:5:"score";s:18:"6.4450633705841724";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:3:"252";s:5:"score";s:18:"6.4450633705841724";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:3:"202";s:5:"score";s:18:"6.4450633705841724";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:2:"44";s:5:"score";s:18:"6.4450633705841724";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:3:"184";s:5:"score";s:17:"6.302145442895745";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:3:"895";s:5:"score";s:17:"5.491215226541485";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:3:"222";s:5:"score";s:17:"5.491215226541485";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:3:"244";s:5:"score";s:17:"4.104920865421595";}}
  _wp_rp_image: empty
  _wp_rp_related_posts_query_result_cache_4: a:8:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:3:"172";s:5:"score";s:18:"15.936333542145587";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:3:"928";s:5:"score";s:17:"15.72996506948202";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:3:"214";s:5:"score";s:18:"14.937121670051123";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:3:"160";s:5:"score";s:18:"12.231565359835919";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:3:"166";s:5:"score";s:18:"11.656201214987526";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"1041";s:5:"score";s:18:"11.566879673608547";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:3:"238";s:5:"score";s:17:"10.86335781555663";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:3:"125";s:5:"score";s:17:"9.360016523152154";}}
author:
  login: pat
  email: patmaddox@me.com
  display_name: pat
  first_name: Pat
  last_name: Maddox
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>By now, most programmers are familiar with the law of demeter.  I think there&#8217;s still a great deal of misunderstanding of what it means and how to use it.  It&#8217;s often tersely explained as a call chain with two dots, but the &#8220;two dots&#8221; rule is merely a heuristic for identifying possible demeter violations.  Seeing a call chain with two dots doesn&#8217;t necessarily mean demeter is being violated.  To understand why, you have to go beyond that simple explanation and think about what it means and why it matters.</p>
<p>In following the law of demeter, our goal is to write encapsulated code.  In writing encapsulated code, our goal is to expose an object&#8217;s behavior while hiding its internal structure.  The key thing to understand is that if your object doesn&#8217;t have behavior, and you&#8217;re primarily interested in the structure, then the law of demeter doesn&#8217;t apply.  Let&#8217;s look at an example.</p>
<p>Say you&#8217;re writing an application that simulates an auto race.  You&#8217;ve got a car domain object, and it has some components to it.  A race track object tells the cars when to start their engines.</p>
<p><script src="http://gist.github.com/495743.js?file=gistfile1.rb"></script>
<p>In this case, you absolutely benefit by applying the law of demeter.  Let&#8217;s say down the road there&#8217;s more work that needs to be done when starting the engine, such as charging a turbofan (I have no clue if that makes sense.  I don&#8217;t know anything about car racing).  If you violate demeter, which looks like</p>
<p><script src="http://gist.github.com/495746.js?file=gistfile1.rb"></script>
<p>you see that you have to change the Race class.  First off, that&#8217;s odd, as you would expect changes to a Car&#8217;s behavior to be made in Car&#8217;s definition, not Race.  Secondly, you&#8217;re guaranteeing bugs somewhere down the road, because when you have a different object start a car&#8217;s engine, you have to maintain this in two spots.  If you don&#8217;t think you&#8217;ll ever have another object that tells a car to start its engine, consider your tests and think again.</p>
<p>Following demeter is valuable when you have behavioral objects.  In the previous example, a Race deals with a Car abstraction, but doesn&#8217;t care anything about the Car&#8217;s engine.  An engine is an internal object that helps the Car do something interesting.</p>
<h2>When you care about structure, expose structure</h2>
<p>Let&#8217;s look at another example, in this case it&#8217;s going to be a Rails app that lets you build a car, selecting the options that you want.  The confirmation page looks something like</p>
<p><script src="http://gist.github.com/495751.js?file=gistfile1.erb"></script>
<p>There&#8217;s no behavior, it&#8217;s all structure.  And in this case, structure is what we care about.  Because of this, following demeter would only result in needless indirection and code without providing any benefits.</p>
<p>The law of demeter is a useful guideline, but as with any other programming guideline you need to understand its subtleties in order to use it effectively.  Demeter should be used as an encapsulation technique, when you want a behavioral object that hides its structural details.  When you&#8217;re interested in an object&#8217;s structure, you&#8217;re better off leaving demeter in your toolbox.</p>
